<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <title>tUploader</title>
    <link href="//netdna.bootstrapcdn.com/bootstrap/3.0.0-rc2/css/bootstrap-glyphicons.css" rel="stylesheet">
    <link href='http://fonts.googleapis.com/css?family=Cantarell' rel='stylesheet' type='text/css'>
    <link href="upload.css" rel="stylesheet">
    <script src="tUploader.js"></script>
    <script src="URI.js"></script>
    <script>
        window.onload = function () {
            var log = document.getElementById('directory');
            var bar = document.getElementById('bar');

            if(typeof tUploader == 'undefined') {
                console.log('Cannot find tUploader. Was tUploader.js loaded?');
            }
            // configure the uploader
            tUploader.stdUploadPath = "upload.json";
            tUploader.varName = 'files';
            tUploader.autoDroparea = true;
            tUploader.domDirectoryContext = document.getElementById('directory');
            tUploader.domProgressBar = document.getElementById('bar');
            tUploader.domLog = document.getElementById('log');

            tUploader.preprocess = function (e, callback) {
                callback();
            };

            tUploader.on("begin", function (params) {
                tUploader.log('Upload started');
            });

            tUploader.on("success", function (params) {
                var response = JSON.parse(params.response);
                tUploader.log('Uploaded successful finished');
                var listItem = document.createElement('LI');
                listItem.innerHTML = tUploader.template.buildItem(response.path, response.name, response.type);
                var directory = tUploader.domDirectoryContext.children[0].children[0];
                directory = directory.children[directory.children.length - 1];
                if(!response.overwrite) {
                    if(directory.children.length > response.order) {
                        directory.insertBefore(listItem, directory.children[response.order]);
                    } else {
                        directory.appendChild(listItem);
                    }
                    tUploader.domProgressBar.style.width = '0%';
                }
            });

            tUploader.on("error", function (params) {
                if(params) {
                    tUploader.log('Error on uploading');
                }
            });

            tUploader.on("progress", function (params) {
                document.getElementById("speed").innerHTML = params.bitrate ? (params.bitrate) + 'kb/s' : "";
                tUploader.domProgressBar.style.width = parseInt(params.globalProgress * 100) + '%';
            });

            // fileList that have been uploaded before
            (function () {
                tUploader.reloadDirectory();
            })();
        }
    </script>
</head>

<body>
You can upload files by using drag and drop onto this page or click here:
<button onclick="tUploader.openFilebrowser()">Upload</button>
<div id="bar"></div>
<div id="speed"></div>
<div id="directory"></div>
<div id="log"></div>

</body>
</html>