<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <title>tUploader</title>
    <link href="//netdna.bootstrapcdn.com/bootstrap/3.0.0-rc2/css/bootstrap-glyphicons.css" rel="stylesheet">
    <link href='http://fonts.googleapis.com/css?family=Cantarell' rel='stylesheet' type='text/css'>
    <link href="upload.css" rel="stylesheet">
    <script src="tUploader.js"></script>
    <script src="URI.js"></script>
    <script>
        window.onload = function () {
            var log = document.getElementById('log');
            var bar = document.getElementById('bar');

            if(typeof tUploader == 'undefined') {
                console.log('Cannot find tUploader. Was tUploader.js loaded?');
            }
            // configure the uploader
            tUploader.stdUploadPath = "upload.json";
            tUploader.varName = 'files';
            tUploader.autoDroparea = true;
            tUploader.domDirectoryContext = document.getElementById('log');
            tUploader.domProgressBar = document.getElementById('bar');

            tUploader.preprocess = function (e, callback) {
                callback();
            };

            tUploader.on("begin", function (params) {
                log.innerHTML += '<br><span class="status begin">Upload started</span>';
            });

            tUploader.on("success", function (params) {
                log.innerHTML += '<br><span class="status success">Uploaded successful finished</span>';

                location.reload();
//                for (var i = 0; i < params.event.files.length; i++) {
//                    var file = params.event.files[i];
//                    log.innerHTML += '<br><a target="_blank" href="/uploads/' + file.name + '">' + file.name + ' </a>';
//                }
            });

            tUploader.on("error", function (params) {
                if(params) {
                    console.log('error', params);
                    log.innerHTML += '<br><span class="status error">Error on uploading</span>';
                }
            });

            tUploader.on("progress", function (params) {
                document.getElementById("speed").innerHTML = params.bitrate ? (params.bitrate) + 'kb/s' : "";
                bar.style.width = parseInt(params.globalProgress * 100) + '%';
            });

            // fileList that have been uploaded before
            (function () {
                tUploader.reloadDirectory();
            })();
        }
    </script>
</head>

<body>
You can upload files by using drag and drop onto this page or click here:
<button onclick="tUploader.openFilebrowser()">Upload</button>
<div id="bar"></div>
<div id="speed"></div>
<div id="log"></div>

</body>
</html>